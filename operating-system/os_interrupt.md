# 인터럽트

## I/O의 수행

모든 I/O 작업(키보드 입력 받기, 화면 출력하기, 디스크 접근하기 등)은 특권 명령으로, 사용자 프로그램이 직접 수행하지 못하고 운영체제를 통해서만 수행 가능하다.  
사용자 프로그램이 CPU에서 실행 중인 상태에서 I/O 작업이 필요하다면, 커널 모드로 변환되어 OS가 실행 가능한 상태가 되어야 한다.  
OS가 실행 가능한 상태가 되면 I/O를 위한 작업을 수행할 수 있고, 작업이 끝난다면 CPU가 다시 사용자 모드로 변환되어야 한다.

## 인터럽트의 개념

위와 같은 상황들에서 사용되는 것이 인터럽트이다.  
I/O 요청이 들어왔는지 안 들어왔는지 주기적으로 확인하는 것(polling)이 아니라, I/O 요청이 들어오면 이벤트를 발생시켜 I/O 요청이 들어왔음을 알리는 것이 인터럽트이다.  
입출력 뿐만 아니라 인터럽트에는 여러 종류가 있다.  
예를 들자면

- 프로그램이 무한루프를 돌고 있어서 이것을 멈추려고 ctrl + C를 누르는, 이 ctrl + C는 사용자가 만든 인터럽트이다.
- 어떤 프로세스가 실행 도중에 다른 프로세스가 사용중인 메모리 영역을 침범하면, 이 때 CPU에 있는 레지스터가 인터럽트를 발생시켜 프로세스를 강제종료 시킨다.

## 동기적 인터럽트와 비동기적 인터럽트

인터럽트는 현재 실행 중인 명령어와의 직접적인 관련성을 기준으로, 프로세스가 실행 중인 명령어에 의해 발생하는 동기적 인터럽트와 실행 중인 명령어와 무관하게 발생하는 비동기적 인터럽트로 나눌 수 있다.

### 동기적 인터럽트

- 프로그램의 문제 때문에 발생하는 인터럽트
  - 다른 사용자의 메모리 영역에 접근하는 경우 등
- 사용자가 의도적으로 프로세스를 중단하기 위해 발생시킨 인터럽트
  - ctrl + C
- 입출력장치에 의한 인터럽트
- 산술 연산 중 발생하는 인터럽트
  - 어떤 수를 0으로 나눈 경우

### 비동기적 인터럽트

- 하드디스크 읽기 오류, 메모리 불량 등의 하드웨어적인 오류로 발생하는 인터럽트

## 하드웨어 인터럽트(Interrupt)와 소프트웨어 인터럽트(Trap)

인터럽트는 발생 주체를 기준으로, 하드웨어가 발생시킨 인터럽트와 소프트웨어가 발생시킨 인터럽트로 나눌 수 있다.

### 하드웨어 인터럽트

- device controller(외부 하드웨어 장치: 키보드, 마우스, 디스크)와 같은 하드웨어가 발생시킨 인터럽트
- 보통의 경우, 인터럽트라고 하면 이 하드웨어 인터럽트를 의미한다.

### 소프트웨어 인터럽트(Trap)

- Exception: 프로그램이 사용할 수 없는 명령어를 쓰려고 하는 경우, CPU 제어권을 사용자 프로그램에서 OS로 넘기기 위해 발생한다.
- System Call: 프로그램이 필요에 의해서 OS를 요청하는 경우 발생한다.
- 소프트웨어 인터럽트는 주로 trap이라고 불린다.

## 인터럽트 처리 과정

인터럽트에는 각 인터럽트마다 해당 인터럽트가 발생하면 어떤 일을 할지(=인터럽트 처리 루틴) 미리 정의되어 있다.  
그리고 각 인터럽트마다 해당 인터럽트가 발생했을 때 어떤 인터럽트 처리 루틴을 실행해야하는지에 대한 정보를 저장하는 인터럽트 벡터가 있다.
![인터럽트 처리 과정](./img/os_interrupt_1.png)

인터럽트가 발생하면

1. 현재 프로세스는 일시 정지 상태가 되고, PCB에 수행 정보를 저장한다.
2. 인터럽트 컨트롤러가 실행되어 인터럽트의 처리 순서를 결정한다

- 여러 인터럽트가 동시에 발생한 경우, 인터럽트의 우선순위를 고려해 중요한 인터럽트부터 먼저 처리한다.

3. 처리할 인터럽트가 결정되면, 인터럽트 벡터가 가리키는 인터럽트 처리 루틴을 실행한다.
4. 인터럽트 처리 루틴이 완료되면, 아까 일시 정지되었던 프로세스가 다시 실행되거나 종료된다.(인터럽트의 종류에 따라 다르다)

## I/O의 수행 - 인터럽트

다시 처음에 소개했던 I/O의 수행으로 돌아가보자.  
사용자 프로그램의 I/O 수행에는 두가지 인터럽트가 사용된다.

1. 사용자 프로그램이 OS에게 I/O 요청을 보낸다. (system call, software interrupt)
2. I/O 작업이 끝나면 I/O 디바이스 -> CPU에게 작업이 다 끝났음을 알리는 인터럽트를 발생시킨다. (hardware interrupt)

## 예상 질문

- 인터럽트의 종류에 대해 설명해주세요.
- 인터럽트 발생 시 처리 과정에 대해 설명해주세요.

<!-- 공부한 내용을 바탕으로 예상 질문을 최소 1개 이상 작성해주세요.-->

## 참고 자료

<!-- 공부 과정에서 참고한 자료가 있다면, 첨부해주세요-->
<!-- * [자료주제](링크)  -->

- [KOCW - 운영체제 (반효경)](http://www.kocw.net/home/cview.do?cid=3646706b4347ef09)
- 쉽게 배우는 운영체제
