# 쿠키와 세션 사용이유

HTTP의 connectionless(비연결성), stateless(비상태성)라는 특징 때문입니다.
클라이언트가 요청(request)을 했을 때 그 요청에 맞는 응답(response)을 보낸 후 연결을 끊고, 서버는 클라이언트에 대한 상태 정보를 유지하지 않기 때문에 알 수 없게 됩니다.
만약 쿠키와 세션을 사용하지 않는다면 로그인을 했음에도 페이지를 이동할 때마다 계속 로그인을 해야됩니다. 또한 로그인을 할때, 아이디 비밀번호 저장을 하여 다음번에 재방문 할 때에도 해당 아이디와 비밀번호를 자동으로
입력하도록 할 수 있습니다.

# 쿠키

쿠키는 웹 서버가 생성하여 웹 브라우저로 전송하는 작은 정보 파일입니다.
웹 브라우저는 수신한 쿠키를 미리 정해진 기간 동안 또는 웹 사이트에서의 사용자 세션 기간 동안 저장합니다.
웹 브라우저는 향후 사용자가 웹 서버에 요청할 때 관련 쿠키를 첨부합니다.
<br/>

### 특징

- Key-Value쌍으로 구성되어 있는 데이터 파일입니다.
- 쿠키이름, 쿠키값, 만료시간, 전송할 도메인명, 전송할 경로, 보안연결여부, HttpOnly여부로 구성되어 있습니다.
- 도메인 당 20개의 쿠키를 가질 수 있습니다.
- 하나의 쿠키는 4KB(= 4096 byte)까지 저장이 가능합니다.

### 동작과정

1. 서버가 클라이언트로부터 요청을 받았을 때, 클라이언트에 대한 정보를 바탕으로 set-cookie 속성을 사용해 "쿠키"를 만든다
2. 서버는 클라이언트에게 해당 요청에 대한 응답을 보낼 때 응답의 Header부분에 쿠키를 담아 보낸다
   (서버로부터 쿠키가 담겨 오는 곳 : response header)
3. 클라이언트가 응답을 받으면 브라우저는 쿠키를 쿠키 디렉터리에 저장 후 또 다시 서버에 요청을 할 때 사용자가 가만히 있어도 브라우저가 request header에 쿠키를 담아서 서버에 전송한다.
4. 서버는 또 다시 response에 쿠키 정보를 참조하여 응답한다.
   <p>
![img](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fWfKsO9P2rReNzJM2doBhQ.png)
</p>

### 예시

- ID저장, 자동로그인
- 쇼핑몰의 장바구니 기능
- 최근 검색한 상품들을 광고에서 추천

# 세션

세션은 웹서버에 웹 컨테이너의 상태를 유지하기 위한 정보를 저장합니다.
브라우저를 닫거나 서버에서 세션을 삭제하면 세션이 삭제됩니다.
세션은 각 클라이언트의 고유세션 ID를 부여하는데, 이것으로 클라이언트를 구분하여 각 클라이언트의 요구에 맞는 응답을 반환합니다.

### 특징

- 사용자 정보 파일을 서버에서 관리합니다.
- 서버에서 클라이언트 구분을 위해 세션 ID를 부여합니다.
- 접속 시간에 제한이 있습니다. (일정 시간 응답이 없다면 정보가 유지되지 않게 설정)
- 사용자가 많아질수록 서버 메모리를 많이 차지합니다.

### 동작과정

1. 세션은 웹 브라우저에 접속하고 페이지를 요청.
2. 서버는 요청받은 request-header의 필드인 cookie를 확인하여 session-id가 있는지 확인한다.
3. 없다면 session-id 쿠키(JSESSIONID)를 만들어 response로 클라이언트에게 보낸다.
4. 쿠키를 전달받은 클라이언트는 같은 브라우저에 재접속 시 만들어진 session-id쿠키를 서버에 같이 전송한다.
5. 서버는 전달받은 session-id 쿠키 값과 서버에 저장되어 있는 session값을 비교하여 같은 사용자인지 판단하여 클라이언트에 맞는 서비스를 제공한다.

### 예시

- 로그인 같이 보안상 중요한 작업을 수행할 때 사용

# 쿠키 vs 세션

- 쿠키는 클라이언트에 저장되지만, 세션은 서버에 저장된다.
- 세션은 서버에 저장되므로 서버의 자원을 사용한다.
- 반면 쿠키는 클라이언트에 저장되므로 서버의 자원을 사용하지 않는다는 이점이 있다.
- 서버에 요청을 보내는 사용자가 많을 경우 세션은 부하가 심할 수 있다.
- 보안면에서 세션이 더 우수하다. 쿠키는 정보를 직접 저장하고 요청을 보낼 수 있다. 만약 쿠키에 사용자의 주민번호 같은 민감한 정보를 그대로 담아 HTTP 요청을 보낸다고 하자. 이때 중간에 정보를 스니핑 당할
  수도 있다.
- 세션은 쿠키를 이용해 쿠키에 세션 ID만 저장하고 서버에서 세션을 처리하기 때문에 비교적 보안성이 좋다.
- 쿠키는 만료시간 동안 파일로 저장되므로 브라우저를 종료해도 정보가 남아있다.
- 세션은 브라우저가 종료되면 만료시간에 상관없이 삭제된다.

#### 1. 사용자의 정보가 저장되는 위치

쿠키는 서버의 자원을 전혀 사용하지 않으며, 세션은 서버의 자원을 사용합니다.

#### 2. 속도

쿠키는 정보가 클라이언트에 있기 때문에 서버에 요청 시 속도가 빠르고 세션은 정보가 서버에 있기 때문에 처리가 요구되어 비교적 속도가 느립니다.


#### 3. 보안

쿠키는 클라이언트 로컬에 저장되기 때문에 변질되거나 request에서 스니핑 당할 우려가 있어서 보안에 취약하지만,
세션은 쿠키를 이용해서 session-id만 저장하고 그것으로 구분하여 서버에서 처리하기 때문에 비교적 보안성이 높습니다.

#### 4. 라이프 사이클

쿠키는 브라우저를 종료해도 정보가 유지될 수 있으며 만료기간을 따로 지정해 쿠키를 삭제할 때까지 유지할 수도 있습니다.
세션은 만료기간을 정할 수 있긴 하지만 브라우저가 종료되면 만료기간에 상관없이 삭제됩니다.


| 	      | 쿠키                    | 	세션                  |
|--------|-----------------------|----------------------|
| 저장 위치  | 	로컬(클라이언트)            | 	서버                  |
| 속도	    | 세션보다 빠름               | 	느림                  |
| 보안 상태	 | 세션보다 안좋음	             | 좋음                   |
| 만료	    | 만료 날짜 지나면 자동 삭제	      | Session Time 초과 시 삭제 |
| 용량 제한	 | 300개, 도메인 20개, 4KB크기	 | 서버가 허용가능한 용량까지       |




# 쿠키와 세션을 통한 인증(authenticaiton)과 인가(authorization)

인증(authentication) : 사용자가 누구인지 확인하는 절차 ex) 회원가입과 로그인

인가(authorization) : 사용자가 요청하는 것에 대한 권한이 있는지를 확인하는 절차

### 쿠키와 세션을 통한 인증, 인가 절차

1. 클라이언트가 로그인 하면 서버는 회원정보를 대조하여 인증합니다. (인증)

2. 회원(클라이언트) 정보를 세션 저장소(서버에 있음)에 생성하고 session ID를 발급합니다.

3. http response header 쿠키 부분에 발급한 session ID를 담아서 보냅니다.

4. 클라이언트에서는 session ID를 쿠키 저장소에 저장하고 이후에 http 요청을 보낼 때마다 쿠키에 session ID를 담아서 보냅니다.

5. 서버에서 쿠키에 담겨 온 session ID에 해당하는 회원 정보를 세션 저장소에서 가져옵니다. (인가)

6. 회원 정보를 바탕으로 처리된 데이터를 응답 메시지에 담아서 클라이언트에 보냅니다.

## 예상 질문

1. 쿠키와 세션의 차이를 알려주세요.
2. 쿠키와 세션의 동작과정에 대해 설명해주세요.

## 참고 자료

<!-- 공부 과정에서 참고한 자료가 있다면, 첨부해주세요-->
<!-- * [자료주제](링크)  -->

- [쿠키란? | 쿠키의 정의](https://www.cloudflare.com/ko-kr/learning/privacy/what-are-cookies/)
- [쿠키와 세션의 동작 원리와 세션의 구조](https://velog.io/@rlfrkdms1/%EC%BF%A0%ED%82%A4%EC%99%80-%EC%84%B8%EC%85%98%EC%9D%98-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC%EC%99%80-%EC%84%B8%EC%85%98%EC%9D%98-%EA%B5%AC%EC%A1%B0)
- [세션(Session) vs 쿠키(Cookie)](https://choimungu.tistory.com/206)