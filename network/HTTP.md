# HTTP

전 세계의 웹 서버로부터 대량의 정보를 빠르고, 간편하고, 정확하게 사람들의 PC에 설치된 웹으로 옮겨줌

웹 서버는 HTTP 프로토콜로 의사소통하기 때문에 보통 HTTP 서버라고 불림

HTTP/3: UDP 사용

## 특징

클라이언트 서버 구조

### 무상태 프로토콜(스테이스리스) ,비 연결성

stateful-상태 유지

항상 같은 서버가 유지 되어야한다 ex)로그인

브라우저 쿠키와 서버 세션을 사용해서 상태 유지

stateless-무 상태 ex) 로그인 필요없는 화면

TCP/IP연결을 새로 맺어야함  ⇒ 지속 연결로 문제 해결

무한한 서버 증설 가능

### HTTP 메시지

HTTP 메시지는 단순한 줄 단위의 문자열

메시지는 인바운드 와 아웃바인드로 이동한다

시작 라인: 메시지의 첫 줄, 요청이라면 무엇을 해야하는지, 응답이라면 무슨 일이 일어났는지 나타냄

요청 메시지

메서드, 요청 URL,  버전 ,헤더 , 엔티티 본문

요청 헤더: 데이터의 타입이 무엇인지 부가 정보 제공

          Accpet: 클라이언트가 선호하는 미디어 타입 전달 

    Accept-Charset:클라이언트가 선호하는 문자 인코딩

    Accept-Encoding: 클라이언트가 선호하는 자연언어

    요청 보안 헤더: ex) Authorization , Cookie

    프락시 요청 헤더

시작 라인= request-line/status-line   ex) GET,POST,PUT,DELETE

요청 메시지- 절대 경로

응답 메시지

HTTP 버전 ,상태코드 , 사유 구졸, 헤더,  엔티티 본문

응답 헤더: 클라이언트에게 정보를 제공하기 위한 자신만의 헤더

          응답 보안헤더

     엔티티헤더

    콘텐츠 헤더

메시지 바디= 엔티티 본문 ⇒ 요청이나 응답에서 전달할 실제 데이터

엔티티 헤더: 데이터 타입, 문자 집합등을 알려줌, 엔티티 본문의 데이터를 해석할 수 있는 정보 제공

헤더: 시작줄 다음에는 0개 이상의 헤더 필드가 이어짐,

일반 헤더: 클라이언트와 서버 양쪽 모두가 사용

본문: 이미지,비디오,오디오 등을 포함

표현 :Content-Type: text/html ,applicaton/json ,image/png

Contenet-Encoding

Content_Language: ko, en ,en-us

Content-Length

## 리소스

웹 서버는 웹 리소스를 관리하고 제공

가장 단순한 웹 리소스는 웹 서버 파일 시스템의 정적 파일 ex)텍스트 파일,HTML파일,워드 파일

동적 콘텐츠가 생성될수도 있음, 웹 게이트웨이도 리소스

미디어 타입

웹 서버는 모든 HTTP 객체 데이터에 MIME 타입을 붙임

웹 브라우저는 서버로부터 객체를 돌려 받을 때 다룰 수 있는지 MIME 타입을 통해 확인

MIME 타입은 사선(/)으로 구분된 주 타입과 부 타입으로 이루어진 문자열 라벨

HTML ⇒ text/html

plain ASCII ⇒text

GIF ⇒ image/gif

## 트랜잭션

HTTP 트랜잭션은 요청 명령과 응답 결과로 구성되어 있다.

애플리 케이션은 보통 하나의 작업을 수행하기 위해 여러 HTTP 트랜잭션을 수행함

## HTTP 메서드

GET: 서버에게 리소스를 달라고 요청하기 위해 쓰임

PUT:  서버에 문서를 쓴다.갱신 해줌

DELETE

POST: 서버에 입력 데이터를 전송, 프락시는 바로 통과시킴

HEAD: GET처럼 행동하지만 서버는 응답으로 헤더만 돌려줌

      리소스를 가져오지 않고도 탑입을 알아낼수 있음

## 정보

### Referer  이전 웹 페이지 주소

현재 요청된 페이지의 이전 웹 페이지 주소

A→B로 이동하는 경우 B를 요청할 때 Referer: A를 포함해서 요청

요청에서 사용

User-Agent: 유저 에이전트 애플리케이션 정보

Server: 서버의 소프트웨어 정보

Date: 응답에서 사용 가능

## 웹의 구성요소

1. 프락시: 클라이언트와 서버 사이에 위치한 HTTP 중재자

   클라이언트의 모든 HTTP 요청을 받아 서버에 전달, 주로 보안을 위해 사용

   ⇒신뢰할 만한 중재자 역할을 함

2. 캐시: 많이 찾는 웹페이지를 클라이언트로 가까이에 보관하는 창고

   특별한 종류의 HTTP 프락시 서버

3. 게이트웨이: 다른 애플리케이션과 연결된 특별한 웹 서버

   HTTP 트래픽을 다른 프로토콜로 변환

4. 터널 단순히 HTTP 통신을 전달하기만 하는 특별한 프락시
5. 에이전트: 사용자를 위해 HTTP 요청을 만들어주는 클라이언트 프로그램

웹 어플리케이션에서 사용자 정보를 저장하는 기술

세션 트랙킹: 과거의 방문 기록을 추적하는 기법0 ex)쿠키

특징

1. HTTP 프로토콜은 Statless 한 특성을 가지기 때문에 사용자가 다시 요청을 보낼 때마다 사용자 정보를 매번 다시 전송

   ⇒ 무상태를 선택한 이유: 적은 자원으로 여러 개의 요청 처리

2. HTTP Session은 쿠키를 사용하여 구현
3. HTTP Session은 사용자 로그인 정보를 관리 할 때 사용, 사용자가 다시 접속 하여도 유지
4. 서버에서 관리되기 때문에 사용자가 임의로 세션 정보를 조작 X, HTTPS를 통해서 암호화

과정

1. 사용자가 로그인을 시도
2.  서버는 사용자의 인증 정보를 검증하여 session id 를 생성
3. 세션은 서버측에서 관리되며, 서버에서 갱신 및 정보 변경
4. 세션 Id는 쿠키 방식으로 사용자에게 전달 되며, 웹 어플리케이션에서 사용

HttpServletRequest 의 getSession()

### 세션 쿠키

사용자가 브라우저를 닫으면 삭제 됨

### 지속 쿠키

삭제 되지 않고 더 길게 유지될 수 있음, 디스크에 저장되어, 컴퓨터를 재시작해도 남아있음

## HTTP 쿠키

세션쿠키와 지속 쿠키 두가지 타입으로나눔

웹 브라우저와 웹 서버 간에 상태 정보를 유지하기 위한 기술

쿠키는 서버가 브라우저는 이를 로컬에 저장하고 필요할 떄마다 서버에 전송하여 사용자 상태 정보 유지

쿠키는 HTTP 헤더에 Set-Cookie와 같은 헤더를 통해 서버에서 클라이언트로 전송

쿠키는 키-값 쌍으로 이루어져 있으며, 이름 ,값, 유효기간 ,도메인 ,경로 등의 정보를 포함

쿠키 생성 방법

서버에서 자동으로 생성하는 쿠키: 응답 메시지를 작성할 때 정해진 쿠키가 없는 경우 자동으로 발행

⇒WAS에서 발행, 톰캣은 JSESSIONID

서버에서 발행하는 쿠키는 기본적으로 브라우저의 메모리상에 보관, 브라우저 종료⇒ 쿠키 삭제

개발자가 작성하는 쿠키: 이름 원하는대로 지정, 유효기간 지정, 경로나 도메인 지정

특징

1.쿠키는 클라이언트 측에 저장된다. 따라서,서버가 클라이언트의 상태 정보를 확인하려면, 쿠키를 클라이언트에서  전송받아야함

2.쿠키는 유효 기간을 가지고 있음, 유효 기간이 지나면, 쿠키는 삭제됨

3.쿠키는 보안 문제가있음 ⇒HTTPS 로 해결

4.쿠키는 브라우저에서 관리 되기 때문에, 브라우저에서 쿠키를 삭제하거나, 다른 브라우저에 접속⇒ 공유X

인증 방법

1.사용자가 로그인 페이지에 접속하여 로그인 정보를 입력

2.서버는 사용자 정보를 검증하고, 인증이 성공하면 사용자의 고유 ID와 함께 인증 토큰을 생성

3.서버는 생성된 인증 토큰을 HTTP 응답 헤더에 포함하여 클라이언트에 전송 Set-Cookie

4.클라이언트는 전송받은 인증 토큰을 로컬에 저장

5.클라이언트는 이후 서버에 요청을 보낼 때마다 인증 토큰을 HTTP 요청 헤더에 포함하여 전송

6.서버는 전송받은 인증 토큰을 검증하여, 인증이 성공하면 요청에 대한 응답을 생성

HTTP Header

서버와 클라이언트 간의 인증을 HTTP 헤더를 통해서 수행하는 방식

특정 header 에 token을 넣어서 사용자를 인식하고 인증